<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Job</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container mt-4">
    <h1 class="text-center mb-4">üìù Create Job</h1>

    <!-- Job Creation Form -->
    <form method="post" id="jobForm" action="{% url 'job-create' %}">
        {% csrf_token %}
        
        <!-- SKU Field -->
        <div class="mb-3">
            <label for="id_sku" class="form-label">SKU</label>
            {{ form.sku }}
        </div>

        <!-- SKU Code Field (Read-only) -->
        <div class="mb-3">
            <label for="id_sku_code" class="form-label">SKU Code</label>
            {{ form.sku_code }}  <!-- Display SKU Code -->
        </div>

        <!-- Material Type Field (Read-only) -->
        <div class="mb-3">
            <label for="id_material_type" class="form-label">Material Type</label>
            {{ form.material_type }}
        </div>

        <!-- Application Type Field (Read-only) -->
        <div class="mb-3">
            <label for="id_application_type" class="form-label">Application Type</label>
            {{ form.application_type }}
        </div>

        <!-- One-up Width Field (Read-only) -->
        <div class="mb-3">
            <label for="id_one_up_width" class="form-label">One-up Width</label>
            {{ form.one_up_width }}
        </div>

        <!-- One-up Height Field (Read-only) -->
        <div class="mb-3">
            <label for="id_one_up_height" class="form-label">One-up Height</label>
            {{ form.one_up_height }}
        </div>

        <!-- Print Sheet Width Field (Read-only) -->
        <div class="mb-3">
            <label for="id_print_sheet_width" class="form-label">Print Sheet Width</label>
            {{ form.print_sheet_width }}
        </div>

        <!-- Print Sheet Height Field (Read-only) -->
        <div class="mb-3">
            <label for="id_print_sheet_height" class="form-label">Print Sheet Height</label>
            {{ form.print_sheet_height }}
        </div>

        <!-- Print Sheet Size Field (Read-only) -->
        <div class="mb-3">
            <label for="id_print_sheet_size" class="form-label">Print Sheet Size</label>
            {{ form.print_sheet_size }}
        </div>

        <!-- UPS Field (Read-only) -->
        <div class="mb-3">
            <label for="id_ups" class="form-label">UPS</label>
            {{ form.ups }}
        </div>

        <!-- Purchase Sheet Width Field (Read-only) -->
        <div class="mb-3">
            <label for="id_purchase_sheet_width" class="form-label">Purchase Sheet Width</label>
            {{ form.purchase_sheet_width }}
        </div>

        <!-- Purchase Sheet Height Field (Read-only) -->
        <div class="mb-3">
            <label for="id_purchase_sheet_height" class="form-label">Purchase Sheet Height</label>
            {{ form.purchase_sheet_height }}
        </div>

        <!-- Purchase Sheet Size Field (Read-only) -->
        <div class="mb-3">
            <label for="id_purchase_sheet_size" class="form-label">Purchase Sheet Size</label>
            {{ form.purchase_sheet_size }}
        </div>

        <!-- Purchase UPS Field (Read-only) -->
        <div class="mb-3">
            <label for="id_purchase_ups" class="form-label">Purchase UPS</label>
            {{ form.purchase_ups }}
        </div>

        <!-- PO Number (Editable by user) -->
        <div class="mb-3">
            <label for="id_po_number" class="form-label">PO Number</label>
            {{ form.po_number }}
        </div>

        <!-- PO Quantity (Editable by user) -->
        <div class="mb-3">
            <label for="id_po_quantity" class="form-label">PO Quantity</label>
            {{ form.po_quantity }}
        </div>

        <!-- Unit Cost (Editable by user) -->
        <div class="mb-3">
            <label for="id_unit_cost" class="form-label">Unit Cost</label>
            {{ form.unit_cost }}
        </div>

        <!-- Customer Name (Editable by user) -->
        <div class="mb-3">
            <label for="id_customer_name" class="form-label">Customer Name</label>
            {{ form.customer_name }}
        </div>

        <!-- Notes (Editable by user) -->
        <div class="mb-3">
            <label for="id_notes" class="form-label">Notes</label>
            {{ form.notes }}
        </div>

        <!-- PO Date (Editable by user) -->
        <div class="mb-3">
            <label for="id_po_date" class="form-label">PO Date</label>
            {{ form.po_date }}
        </div>

        <!-- Planned Date (Editable by user) -->
        <div class="mb-3">
            <label for="id_planned_date" class="form-label">Planned Date</label>
            {{ form.planned_date }}
        </div>

        <button type="submit" class="btn btn-success">Save Job</button>
    </form>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- AJAX Script for Auto-fetching Recipe -->
<script>
$(document).ready(function() {
    // Trigger AJAX call when SKU is entered
    $("#id_sku").on('change', function() {
        var sku = $(this).val();  // Get the SKU value
        if (sku) {
            $.ajax({
                url: "{% url 'fetch_recipe' %}",
                data: {'sku': sku},  // Send SKU as a GET parameter
                dataType: 'json',
                success: function(response) {
                    if (response.error) {
                        alert(response.error);  // Show error if recipe not found
                    } else {
                        // Populate the fields with fetched recipe data
                        $("#id_sku_code").val(response.sku_code);  // Set SKU code in sku_code field
                        $("#id_material_type").val(response.material_type);  // Set material type
                        $("#id_application_type").val(response.application_type);  // Set application type
                        $("#id_one_up_width").val(response.one_up_width);  // Set one-up width
                        $("#id_one_up_height").val(response.one_up_height);  // Set one-up height
                        $("#id_print_sheet_width").val(response.print_sheet_width);  // Set print sheet width
                        $("#id_print_sheet_height").val(response.print_sheet_height);  // Set print sheet height
                        $("#id_print_sheet_size").val(response.print_sheet_size);  // Set print sheet size
                        $("#id_ups").val(response.ups);  // Set UPS
                        $("#id_purchase_sheet_width").val(response.purchase_sheet_width);  // Set purchase sheet width
                        $("#id_purchase_sheet_height").val(response.purchase_sheet_height);  // Set purchase sheet height
                        $("#id_purchase_sheet_size").val(response.purchase_sheet_size);  // Set purchase sheet size
                        $("#id_purchase_ups").val(response.purchase_ups);  // Set purchase UPS
                    }
                },
                error: function() {
                    alert("Error fetching recipe.");
                }
            });
        }
    });
});
</script>

</body>
</html>
